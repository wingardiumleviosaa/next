<!doctype html><html lang=en data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.112.3"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32x32.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon.png><meta itemprop=name content="[Oracle] Install Oracle 11g XE and Establish CDC by Debezium"><meta itemprop=description content="♾️ Everyone Is An Alien Somewhere"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://ulagraphy.netlify.com/imgs/riley.png"><meta itemprop=keywords content="Debezium,CDC,Oracle"><meta property="og:type" content="article"><meta property="og:title" content="[Oracle] Install Oracle 11g XE and Establish CDC by Debezium"><meta property="og:description" content="♾️ Everyone Is An Alien Somewhere"><meta property="og:image" content="/imgs/riley.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://ulagraphy.netlify.com/post/data-oracle-11g-xe-cdc-debezium/install-oracle-11g-and-establish-cdc-by-debezium/"><meta property="og:site_name" content="UlaGraphy"><meta property="og:locale" content="en"><meta property="article:author" content="Ula"><meta property="article:published_time" content="2022-01-19 11:03:00 +0000 UTC"><meta property="article:modified_time" content="2022-01-19 11:03:00 +0000 UTC"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.59da712cfdcceff10e0d33fef76aa6667f7daed10d7691d3d187f5b7782b3f5e.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"install-oracle-11g-and-establish-cdc-by-debezium","permalink":"https://ulagraphy.netlify.com/post/data-oracle-11g-xe-cdc-debezium/install-oracle-11g-and-establish-cdc-by-debezium/","title":"[Oracle] Install Oracle 11g XE and Establish CDC by Debezium","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>[Oracle] Install Oracle 11g XE and Establish CDC by Debezium - UlaGraphy</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>UlaGraphy</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>OOM.</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>Home</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>About</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>Archives
<span class=badge>191</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>Search</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class=search-result-container><div class=algolia-hits></div></div><div class=search-footer><div class=algolia-pagination></div><div class=search-meta-info><div class="search-hit-stats algolia-stats"></div><div class=search-vendor><span>Search By</span>
<a title=Algolia target=_blank href="https://www.algolia.com/?utm_source=instantsearch.js&utm_medium=website&utm_content=ulagraphy.netlify.com&utm_campaign=poweredby"><img src=/imgs/algolia-logo.svg></a></div></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>TOC</li><li class=sidebar-nav-overview>Overview</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#debezium>Debezium</a><ul><li><a href=#簡介>簡介</a></li><li><a href=#cdc>CDC</a></li></ul></li><li><a href=#安裝-oracle-11g-express-edition>安裝 Oracle 11g Express Edition</a><ul><li><a href=#create-container>Create Container</a></li><li><a href=#connect-to-the-database>Connect to the Database</a></li></ul></li><li><a href=#oracle-cdc-logmior-configuration>Oracle CDC (Logmior) Configuration</a><ul><li><a href=#開啟日誌歸檔>開啟日誌歸檔</a></li><li><a href=#安裝-logminer-工具>安裝 logminer 工具</a></li><li><a href=#啟動最小附加日誌>啟動最小附加日誌</a></li><li><a href=#建立-logminer-用戶並賦予權限>建立 logminer 用戶並賦予權限</a></li></ul></li><li><a href=#架設-debezium-環境>架設 Debezium 環境</a><ul><li><a href=#安裝-zookeeper--kafka>安裝 Zookeeper ＆ Kafka</a></li><li><a href=#準備新的-kafka-connect-image>準備新的 Kafka Connect Image</a></li><li><a href=#安裝-kafka-connect>安裝 Kafka Connect</a></li><li><a href=#配置-oracle-connector>配置 Oracle Connector</a></li><li><a href=#查看-connector-狀態>查看 Connector 狀態</a></li><li><a href=#增刪改資料表並查看-kafka-topic-是否有收到-log-資料>增刪改資料表並查看 Kafka Topic 是否有收到 log 資料</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt="Ula Hsieh" src=/imgs/img-lazy-loading.gif data-src=/imgs/riley.png><p class=site-author-name itemprop=name>Ula Hsieh</p><div class=site-description itemprop=description>♾️ Everyone Is An Alien Somewhere</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>191</span>
<span class=site-state-item-name>Posts</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>28</span>
<span class=site-state-item-name>Categories</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>52</span>
<span class=site-state-item-name>Tags</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/wingardiumleviosaa title="Github → https://github.com/wingardiumleviosaa" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i></a></span>
<span class=links-of-social-item><a href=https://www.linkedin.com/in/ulah/ title="LinkedIn → https://www.linkedin.com/in/ulah/" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-linkedin fa-fw hvr-icon"></i></a></span>
<span class=links-of-social-item><a href=/ulahsieh-cv.pdf title="Reseme → /ulahsieh-cv.pdf" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-id-card fa-fw hvr-icon"></i></a></span>
<span class=links-of-social-item><a href=mailto:yiju.117@gmail.com title="Mail → mailto:yiju.117@gmail.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i></a></span></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title="Change Theme"><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title="Back to Top"><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://ulagraphy.netlify.com/post/data-oracle-11g-xe-cdc-debezium/install-oracle-11g-and-establish-cdc-by-debezium/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/riley.png"><meta itemprop=name content="Ula"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Ula Hsieh"><meta itemprop=description content="♾️ Everyone Is An Alien Somewhere"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="[Oracle] Install Oracle 11g XE and Establish CDC by Debezium"><meta itemprop=description content="Debezium

簡介

Debezium 是一個由 RedHat 開源的基於資料庫變更日誌的實時變更數據捕獲（CDC）工具，構建在 Apache Kafka 之上，是 Apache Kafka Connect 的 Source Connector，可以實時獲取行級別（row-level）資料的更改事件（INSERT、UPDATE 和 DELETE）並同步到 Kafka。目前支援的常見資料庫有 MySQL(binlog)、Oracle(logminer or xstream)、MongoDB(change streams)、PostgreSQL(logical replication stream mode)、SQL Server(transaction log)&mldr;等。本文範例是使用 Oracle 的 logminer 日誌透過 Debezium 獲取指定資料庫的變更事件。"></span><header class=post-header><h1 class=post-title itemprop="name headline">[Oracle] Install Oracle 11g XE and Establish CDC by Debezium</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text title="Publish on">Publish on:</span>
<time title="Create Time:2022-01-19 11:03:00 +0000 UTC" itemprop="dateCreated datePublished" datetime="2022-01-19 11:03:00 +0000 UTC">2022-01-19</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text title="Classify at">Classify at:</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/kafka itemprop=url rel=index><span itemprop=name>DataEngineering/Kafka</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=Words><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>Words:</span>
<span>2889</span></span>
<span class=post-meta-item title=Read><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>Read:&ap;</span>
<span>6mins</span></span></div></div></header><div class=post-body itemprop=articleBody><h2 id=debezium>Debezium
<a class=header-anchor href=#debezium></a></h2><h3 id=簡介>簡介
<a class=header-anchor href=#%e7%b0%a1%e4%bb%8b></a></h3><p>Debezium 是一個由 RedHat 開源的基於資料庫變更日誌的實時變更數據捕獲（CDC）工具，構建在 Apache Kafka 之上，是 Apache Kafka Connect 的 Source Connector，可以實時獲取行級別（row-level）資料的更改事件（INSERT、UPDATE 和 DELETE）並同步到 Kafka。目前支援的常見資料庫有 MySQL(binlog)、Oracle(logminer or xstream)、MongoDB(change streams)、PostgreSQL(logical replication stream mode)、SQL Server(transaction log)&mldr;等。本文範例是使用 Oracle 的 logminer 日誌透過 Debezium 獲取指定資料庫的變更事件。</p><h3 id=cdc>CDC
<a class=header-anchor href=#cdc></a></h3><p>CDC 全稱是 Change Data Capture 變更數據捕獲，它是一個比較廣義的概念，只要能捕獲變更的資料，都可以稱為 CDC，主要有基於查詢的 CDC 和基於日誌的 CDC。</p><table><thead><tr><th style=text-align:center></th><th style=text-align:center>基於查詢的 CDC</th><th style=text-align:center>基於日誌的 CDC</th></tr></thead><tbody><tr><td style=text-align:center>概念</td><td style=text-align:center>每次捕獲變更發起 Select 查詢進行全表掃描，過濾出查詢之間變更的資料</td><td style=text-align:center>讀取資料儲存系統的 log ，例如 Mysql 裡面的 binlog持續監控</td></tr><tr><td style=text-align:center>開源產品</td><td style=text-align:center>Sqoop, Kafka JDBC Source</td><td style=text-align:center>Canal, Maxwell, Debezium</td></tr><tr><td style=text-align:center>執行模式</td><td style=text-align:center>Batch</td><td style=text-align:center>Streaming</td></tr><tr><td style=text-align:center>捕獲所有資料的變化</td><td style=text-align:center>X</td><td style=text-align:center>O</td></tr><tr><td style=text-align:center>低延遲，不增加資料庫負載</td><td style=text-align:center>X</td><td style=text-align:center>O</td></tr><tr><td style=text-align:center>不侵入業務（LastUpdated欄位）</td><td style=text-align:center>X</td><td style=text-align:center>O</td></tr><tr><td style=text-align:center>捕獲刪除事件和舊記錄的狀態</td><td style=text-align:center>X</td><td style=text-align:center>O</td></tr><tr><td style=text-align:center>捕獲舊記錄的狀態</td><td style=text-align:center>X</td><td style=text-align:center>O</td></tr></tbody></table><h2 id=安裝-oracle-11g-express-edition>安裝 Oracle 11g Express Edition
<a class=header-anchor href=#%e5%ae%89%e8%a3%9d-oracle-11g-express-edition></a></h2><h3 id=create-container>Create Container
<a class=header-anchor href=#create-container></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker run -d -it --name oracle -p 1521:1521 -e ORACLE_ALLOW_REMOTE=true -v oracle:/u01/app/oracle --restart=always wnameless/oracle-xe-11g-r2
</span></span></code></pre></div><h3 id=connect-to-the-database>Connect to the Database
<a class=header-anchor href=#connect-to-the-database></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ docker ps
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>CONTAINER ID   IMAGE                        COMMAND                  CREATED         STATUS         PORTS                                                         NAMES
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>624e811e8e0b   wnameless/oracle-xe-11g-r2   <span style=color:#e6db74>&#34;/bin/sh -c &#39;/usr/sb…&#34;</span>   <span style=color:#ae81ff>3</span> minutes ago   Up <span style=color:#ae81ff>3</span> minutes   22/tcp, 8080/tcp, 0.0.0.0:1521-&gt;1521/tcp, :::1521-&gt;1521/tcp   oracle
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>$ docker logs -f oracle
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>Starting Oracle Net Listener.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>Starting Oracle Database 11g Express Edition instance.
</span></span></code></pre></div><p>使用資料庫工具連線進入</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>hostname: localhost
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>port: 1521
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>sid: xe
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>username: system
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>password: oracle
</span></span></code></pre></div><p>Password for SYS & SYSTEM</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>oracle
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://imgur.com/HLKyKzq.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://imgur.com/pDC97QK.png alt></p><h2 id=oracle-cdc-logmior-configuration>Oracle CDC (Logmior) Configuration
<a class=header-anchor href=#oracle-cdc-logmior-configuration></a></h2><h3 id=開啟日誌歸檔>開啟日誌歸檔
<a class=header-anchor href=#%e9%96%8b%e5%95%9f%e6%97%a5%e8%aa%8c%e6%ad%b8%e6%aa%94></a></h3><ol><li>進入容器並切換成 oracle 使用者，再透過 sqlplus 以 sys 用戶登入進入資料庫</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker exec -it oracle /bin/bash
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>[root@b2a1bd25aa97 /]# su — oracle
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>[root@b2a1bd25aa97 /]# sqlplus sys/oracle as sysdba
</span></span></code></pre></div><ol start=2><li>檢查日誌歸檔是否已開啟。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>archive log list;
</span></span></code></pre></div><ul><li>若顯示 “Database log mode: No Archive Mode”，說明日誌歸檔未開啟，繼續執行下一步。</li><li>若顯示 “Database log mode: Archive Mode”，說明日誌歸檔已開啟，直接跳到退出數據庫連接。</li></ul><ol start=3><li>執行以下命令配置歸檔日誌參數。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>system</span> <span style=color:#66d9ef>set</span> db_recovery_file_dest_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span><span style=color:#66d9ef>G</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>system</span> <span style=color:#66d9ef>set</span> db_recovery_file_dest <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/u01/app/oracle/oradata/recovery_area&#39;</span> <span style=color:#66d9ef>scope</span><span style=color:#f92672>=</span>spfile;
</span></span></code></pre></div><p>其中：</p><ul><li>10G 為日誌文件存儲空間的大小，請根據實際情況設置。</li><li>/u01/app/oracle/oradata/recovery_area 為日誌存儲路徑，須確保路徑提前創建。</li></ul><ol start=4><li>開啟日誌歸檔。</li></ol><style type=text/css>.notice{--root-color:#444;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#c33;--warning-content:#fee;--info-title:#fb7;--info-content:#fec;--note-title:#6be;--note-content:#e7f2fa;--tip-title:#5a5;--tip-content:#efe}@media(prefers-color-scheme:dark){.notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}}body.dark .notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--root-color);background:var(--root-background)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background)}.notice.warning .notice-title{background:var(--warning-title)}.notice.warning{background:var(--warning-content)}.notice.info .notice-title{background:var(--info-title)}.notice.info{background:var(--info-content)}.notice.note .notice-title{background:var(--note-title)}.notice.note{background:var(--note-content)}.notice.tip .notice-title{background:var(--tip-title)}.notice.tip{background:var(--tip-content)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379.0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628.0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628.0l-22.627 22.627c-6.248 6.248-6.248 16.379.0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196.0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627.0 12 5.373 12 12v1e2h12c6.627.0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice info"><p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#info-notice"/></svg></span>Info</p><p>須知：
開啟日誌歸檔功能需重啟數據庫，重啟期間將導致業務中斷，請謹慎操作。
歸檔日誌會佔用較多的磁盤空間，若磁盤空間滿了會影響業務，請定期清理過期歸檔日誌。</p></div></br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>shutdown <span style=color:#66d9ef>immediate</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>startup mount;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>database</span> archivelog;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>database</span> <span style=color:#66d9ef>open</span>;
</span></span></code></pre></div><ol start=5><li>確認日誌歸檔是否已成功開啟。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>archive log list;
</span></span></code></pre></div><p>當顯示 “Database log mode: Archive Mode”，說明日誌歸檔已開啟。</p><ol start=6><li>退出資料庫連接。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>exit;
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://imgur.com/Ghsl3lu.png alt></p><h3 id=安裝-logminer-工具>安裝 logminer 工具
<a class=header-anchor href=#%e5%ae%89%e8%a3%9d-logminer-%e5%b7%a5%e5%85%b7></a></h3><ol><li>重新連接到資料庫</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sqlplus sys<span style=color:#f92672>/</span>oracle <span style=color:#66d9ef>as</span> sysdba
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#f92672>#</span> sqlplus sys<span style=color:#f92672>/</span>password<span style=color:#f92672>@</span><span style=color:#66d9ef>host</span>:port<span style=color:#f92672>/</span>SID <span style=color:#66d9ef>as</span> sysdba
</span></span></code></pre></div><ol start=2><li>檢查 LogMiner 工具是否已安裝
如果有返回訊息說明 LogMiner 已安裝</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>desc</span> DBMS_LOGMNR
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>desc</span> DBMS_LOGMNR_D
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://imgur.com/cFw9dsR.png alt></p><p>如果沒有訊息返回則需要另外安裝，請執行以下命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>創建</span> dbms_logmnr <span style=color:#960050;background-color:#1e0010>包，用來分析歸檔日誌</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#f92672>@</span><span style=color:#960050;background-color:#1e0010>$</span>ORACLE_HOME<span style=color:#f92672>/</span>rdbms<span style=color:#f92672>/</span><span style=color:#66d9ef>admin</span><span style=color:#f92672>/</span>dbmslm.<span style=color:#66d9ef>sql</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>創建</span>DBMS_LOGMNR_D<span style=color:#960050;background-color:#1e0010>包，該包用來創建數據字典文件。</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#f92672>@</span><span style=color:#960050;background-color:#1e0010>$</span>ORACLE_HOME<span style=color:#f92672>/</span>rdbms<span style=color:#f92672>/</span><span style=color:#66d9ef>admin</span><span style=color:#f92672>/</span>dbmslmd.<span style=color:#66d9ef>sql</span>
</span></span></code></pre></div><h3 id=啟動最小附加日誌>啟動最小附加日誌
<a class=header-anchor href=#%e5%95%9f%e5%8b%95%e6%9c%80%e5%b0%8f%e9%99%84%e5%8a%a0%e6%97%a5%e8%aa%8c></a></h3><p>啟用附加最小日誌（supplemental_log_data_min）可以確保 LogMiner（或其他任何基於 LogMiner 的產品）可以支援行連結、簇表、索引組織表等，避免在挖掘時會出現信息遺漏的情況。
驗證是否有啟用附加日誌：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>SELECT</span> supplemental_log_data_min, supplemental_log_data_pk, supplemental_log_data_all <span style=color:#66d9ef>FROM</span> v$database;
</span></span></code></pre></div><p>預設是沒有開啟的(return no/no/no)，在 <strong>資料庫級別</strong> 啟用最小補充日誌記錄，按如下方式配置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>DATABASE</span> <span style=color:#66d9ef>ADD</span> SUPPLEMENTAL LOG <span style=color:#66d9ef>DATA</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>DATABASE</span> <span style=color:#66d9ef>ADD</span> SUPPLEMENTAL LOG <span style=color:#66d9ef>DATA</span> (<span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>) COLUMNS;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>DATABASE</span> <span style=color:#66d9ef>ADD</span> SUPPLEMENTAL LOG <span style=color:#66d9ef>DATA</span> (<span style=color:#66d9ef>ALL</span>) COLUMNS; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#f92672>#</span> <span style=color:#66d9ef>commit</span> the changes
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>SYSTEM</span> ARCHIVE LOG <span style=color:#66d9ef>CURRENT</span>;
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://imgur.com/ScoREMo.png alt></p><p>如果只是想給某個指定的表，開啟附加日誌記錄，參考下面。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> HR.EMPLOYEES <span style=color:#66d9ef>ADD</span> SUPPLEMENTAL LOG <span style=color:#66d9ef>DATA</span> (<span style=color:#66d9ef>ALL</span>) COLUMNS;
</span></span></code></pre></div><h3 id=建立-logminer-用戶並賦予權限>建立 logminer 用戶並賦予權限
<a class=header-anchor href=#%e5%bb%ba%e7%ab%8b-logminer-%e7%94%a8%e6%88%b6%e4%b8%a6%e8%b3%a6%e4%ba%88%e6%ac%8a%e9%99%90></a></h3><ol><li>創建專屬 tablespace</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>CREATE</span> TABLESPACE LOGMINER_TBS DATAFILE <span style=color:#e6db74>&#39;/u01/app/oracle/oradata/XE/logminer_tbs.dbf&#39;</span> <span style=color:#66d9ef>SIZE</span> <span style=color:#ae81ff>25</span>M REUSE AUTOEXTEND <span style=color:#66d9ef>ON</span> MAXSIZE UNLIMITED;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>USER</span> logminer IDENTIFIED <span style=color:#66d9ef>BY</span> logminer <span style=color:#66d9ef>DEFAULT</span> TABLESPACE logminer_tbs QUOTA UNLIMITED <span style=color:#66d9ef>ON</span> logminer_tbs;
</span></span></code></pre></div><ol start=2><li>創建 logMiner 使用者並配置權限。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>create</span> <span style=color:#66d9ef>session</span>, <span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>session</span>, <span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>system</span>, execute_catalog_role, select_catalog_role, <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>any</span> <span style=color:#66d9ef>transaction</span>, <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>any</span> <span style=color:#66d9ef>dictionary</span>, <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>any</span> <span style=color:#66d9ef>table</span>, <span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span>, <span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>any</span> <span style=color:#66d9ef>table</span>, <span style=color:#66d9ef>create</span> sequence, <span style=color:#66d9ef>lock</span> <span style=color:#66d9ef>any</span> <span style=color:#66d9ef>table</span>, flashback <span style=color:#66d9ef>any</span> <span style=color:#66d9ef>table</span>, <span style=color:#66d9ef>create</span> tablespace, <span style=color:#66d9ef>drop</span> tablespace <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>connect</span> <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>trigger</span> <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>SYSTEM</span>.LOGMNR_COL$ <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>SYSTEM</span>.LOGMNR_OBJ$ <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>SYSTEM</span>.LOGMNR_USER$ <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>SYSTEM</span>.LOGMNR_UID$ <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>execute</span> <span style=color:#66d9ef>on</span> SYS.DBMS_LOGMNR <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>execute</span> <span style=color:#66d9ef>on</span> SYS.DBMS_LOGMNR_D <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>execute</span> <span style=color:#66d9ef>on</span> SYS.DBMS_LOGMNR_LOGREP_DICT <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>execute</span> <span style=color:#66d9ef>on</span> SYS.DBMS_LOGMNR_SESSION <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>on</span> V_$DATABASE <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>ON</span> V_$LOG <span style=color:#66d9ef>TO</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>ON</span> V_$LOG_HISTORY <span style=color:#66d9ef>TO</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>ON</span> V_$LOGMNR_LOGS <span style=color:#66d9ef>TO</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>ON</span> V_$LOGMNR_CONTENTS <span style=color:#66d9ef>TO</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>ON</span> V_$LOGMNR_PARAMETERS <span style=color:#66d9ef>TO</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>ON</span> V_$LOGFILE <span style=color:#66d9ef>TO</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>ON</span> V_$ARCHIVED_LOG <span style=color:#66d9ef>TO</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>ON</span> V_$ARCHIVE_DEST_STATUS <span style=color:#66d9ef>TO</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>on</span> gv_$logmnr_parameters <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>on</span> gv_$logmnr_logs <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>on</span> gv_$archived_log <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>on</span> v_$logmnr_dictionary <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>on</span> V_$TRANSACTION <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>EXECUTE</span> <span style=color:#66d9ef>ON</span> DBMS_LOGMNR <span style=color:#66d9ef>TO</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>EXECUTE</span> <span style=color:#66d9ef>ON</span> DBMS_LOGMNR_D <span style=color:#66d9ef>TO</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>all</span> <span style=color:#66d9ef>on</span> DBMS_LOGMNR_D <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>all</span> <span style=color:#66d9ef>on</span> DBMS_LOGMNR <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>on</span> dba_objects <span style=color:#66d9ef>to</span> logminer;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#66d9ef>GRANT</span> UNLIMITED TABLESPACE <span style=color:#66d9ef>TO</span> logminer;
</span></span></code></pre></div><h2 id=架設-debezium-環境>架設 Debezium 環境
<a class=header-anchor href=#%e6%9e%b6%e8%a8%ad-debezium-%e7%92%b0%e5%a2%83></a></h2><h3 id=安裝-zookeeper--kafka>安裝 Zookeeper ＆ Kafka
<a class=header-anchor href=#%e5%ae%89%e8%a3%9d-zookeeper--kafka></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker run -d -it --name zookeeper -p 2181:2181 -p 2888:2888 -p 3888:3888 debezium/zookeeper:1.5
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#75715e># 為了給外部連線使用，kafka 需設置 advertised_listeners 參數</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>docker run -d -it --name kafka -p 9092:9092 -e ADVERTISED_HOST_NAME<span style=color:#f92672>=</span>10.13.1.105 -e ADVERTISED_LISTENERS<span style=color:#f92672>=</span>PLAINTEXT://10.13.1.105:9092 --link zookeeper:zookeeper debezium/kafka:1.5
</span></span></code></pre></div><h3 id=準備新的-kafka-connect-image>準備新的 Kafka Connect Image
<a class=header-anchor href=#%e6%ba%96%e5%82%99%e6%96%b0%e7%9a%84-kafka-connect-image></a></h3><p>根據官網的提示，如果要連接 oracle 需要自行下載並複製 jdbc driver 到 kafka connect 中。</p><blockquote><p>Due to licensing requirements, the Debezium Oracle connector does not ship with the Oracle JDBC driver or XStream API files. You must download these files directly from Oracle and add them to your environment.</p></blockquote><p>步驟如下：</p><ol><li>下載 oracle instant clinet</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>wget https://download.oracle.com/otn_software/linux/instantclient/185000/instantclient-basic-linux.x64-18.5.0.0.0dbru.zip
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#75715e># 解壓縮</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>unzip instantclient-basic-linux.x64-18.5.0.0.0dbru.zip
</span></span></code></pre></div><ol start=2><li>啟動臨時的 container</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker run -d -it --name connect -p 8083:8083 -e GROUP_ID<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -e CONFIG_STORAGE_TOPIC<span style=color:#f92672>=</span>test_connect_configs -e OFFSET_STORAGE_TOPIC<span style=color:#f92672>=</span>test_connect_offsets -e STATUS_STORAGE_TOPIC<span style=color:#f92672>=</span>test_connect_statuses --link zookeeper:zookeeper --link kafka:kafka debezium/connect:1.5
</span></span></code></pre></div><p>其中，需要傳入如下環境變數：</p><ul><li>GROUP_ID：若需要啟動多個 Debezium 例項組成叢集，那麼它們的 GROUP_ID 必須被設一樣。</li><li>CONFIG_STORAGE_TOPIC：指定用來存 connector 的 config 資訊的 kafka topic。</li><li>STATUS_STORAGE_TOPIC：指定用來儲存 connector 的狀態資訊的 kafka topic。</li><li>OFFSET_STORAGE_TOPIC：只定用來存 connector 監控資料流的 offset 的 kafka topic，若使用的是 Oracle Connector，那麼該 topic 存的就是 Oracle logminer 的 scn。</li></ul><ol start=3><li>製作新的 kafka connect image
首先複製整個 instant clinet 的資料夾到 container 中</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker cp ./instantclient_18_5/ connect:/kafka/
</span></span></code></pre></div><p>進入 container 中，將 instantclinet 下的 jdbc driver 複製到 /kafka/libs 底下 (因為本文範例使用 logminer 監聽 CDC，故僅需將 ojdbc8.jar 複製，xstreams.jar 檔只有在 xstream 模式下才需要使用到)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker exec -it connect /bin/bash
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>[kafka@88c5e1f0af86 ~]$ ls
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>LICENSE  bin     config.orig  data           instantclient_18_5  logs
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>NOTICE   config  connect      external_libs  libs
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>[kafka@88c5e1f0af86 ~]$ cp instantclient_18_5/ojdbc8.jar libs/
</span></span></code></pre></div><p>退出 container，查看 container id 後將狀態 commit 成新的 image</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker ps
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>CONTAINER ID   IMAGE                        COMMAND                  CREATED        STATUS        PORTS                                                                                                                                                 NAMES
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>88c5e1f0af86   connect:1.5              &#34;/docker-entrypoint.…&#34;   21 hours ago   Up 21 hours   8778/tcp, 9092/tcp, 0.0.0.0:8083-&gt;8083/tcp, :::8083-&gt;8083/tcp, 9779/tcp                                                                               connect
</span></span></code></pre></div></br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker commit 88c5e1f0af86 connect:tmp
</span></span></code></pre></div><p>準備一個 Dockerfile</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>FROM connect:tmp
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>USER root
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>RUN yum -y install libaio &amp;&amp; yum clean all
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>USER kafka
</span></span></code></pre></div><p>Build 最終的 docker image</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker build -t connect:1.5.1
</span></span></code></pre></div><h3 id=安裝-kafka-connect>安裝 Kafka Connect
<a class=header-anchor href=#%e5%ae%89%e8%a3%9d-kafka-connect></a></h3><p>從上一步驟包的 kafka connect image 建立正式的 connect container，注意要加上 <code>LD_LIBRARY_PATH</code> 環境變數指向 instantclient 的目錄</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker run -d -it --name connect -p 8083:8083 -e GROUP_ID<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -e CONFIG_STORAGE_TOPIC<span style=color:#f92672>=</span>test_connect_configs -e OFFSET_STORAGE_TOPIC<span style=color:#f92672>=</span>test_connect_offsets -e STATUS_STORAGE_TOPIC<span style=color:#f92672>=</span>test_connect_statuses -e LD_LIBRARY_PATH<span style=color:#f92672>=</span>/kafka/instantclient_18_5 --link zookeeper:zookeeper --link kafka:kafka connect:1.5.1
</span></span></code></pre></div><p>查看 kafka connect 的資訊以及 connector 列表</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>curl -H <span style=color:#e6db74>&#34;Accept:application/json&#34;</span> localhost:8083/
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>curl -H <span style=color:#e6db74>&#34;Accept:application/json&#34;</span> localhost:8083/connectors/
</span></span></code></pre></div><h3 id=配置-oracle-connector>配置 Oracle Connector
<a class=header-anchor href=#%e9%85%8d%e7%bd%ae-oracle-connector></a></h3><p>呼叫 kafka connect 的 connector API 以創建 connector</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>curl -i -X PUT -H <span style=color:#e6db74>&#34;Accept:application/json&#34;</span> -H <span style=color:#e6db74>&#34;Content-Type:application/json&#34;</span>  localhost:8083/connectors/oracle1/config -d <span style=color:#e6db74>&#39;{&#34;name&#34;: &#34;oracle1&#34;, &#34;connector.class&#34;: &#34;io.debezium.connector.oracle.OracleConnector&#34;, &#34;tasks.max&#34;: &#34;1&#34;,&#34;database.server.name&#34;: &#34;XE&#34;, &#34;database.hostname&#34;: &#34;10.13.1.105&#34;, &#34;database.port&#34;: &#34;1521&#34;, &#34;database.user&#34;: &#34;logminer&#34;, &#34;database.password&#34;: &#34;logminer&#34;, &#34;database.dbname&#34;: &#34;XE&#34;, &#34;database.out.server.name&#34;: &#34;dbzout&#34;, &#34;database.schema&#34;: &#34;HR&#34;, &#34;database.history.kafka.bootstrap.servers&#34;: &#34;kafka:9092&#34;, &#34;database.history.kafka.topic&#34;: &#34;utest&#34;, &#34;database.connection.adapter&#34;: &#34;logminer&#34;, &#34;table.include.list&#34;: &#34;HR.*&#34;, &#34;snapshot.mode&#34;: &#34;initial&#34;, &#34;database.tablename.case.insensitive&#34;: &#34;true&#34;, &#34;decimal.handling.mode&#34;: &#34;string&#34;, &#34;log.mining.strategy&#34;: &#34;online_catalog&#34;}&#39;</span>
</span></span></code></pre></div><p>覺得 curl 不方便，可以換用 postman：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;oracle1&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#f92672>&#34;connector.class&#34;</span>:<span style=color:#e6db74>&#34;io.debezium.connector.oracle.OracleConnector&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f92672>&#34;tasks.max&#34;</span>:<span style=color:#e6db74>&#34;1&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f92672>&#34;database.hostname&#34;</span>:<span style=color:#e6db74>&#34;10.13.1.105&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#f92672>&#34;database.port&#34;</span>:<span style=color:#e6db74>&#34;1521&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#f92672>&#34;database.user&#34;</span>:<span style=color:#e6db74>&#34;logminer&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#f92672>&#34;database.password&#34;</span>:<span style=color:#e6db74>&#34;logminer&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#f92672>&#34;database.dbname&#34;</span>:<span style=color:#e6db74>&#34;XE&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#f92672>&#34;database.server.name&#34;</span>:<span style=color:#e6db74>&#34;XE&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#f92672>&#34;database.history.kafka.bootstrap.servers&#34;</span>:<span style=color:#e6db74>&#34;kafka:9092&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#f92672>&#34;database.history.kafka.topic&#34;</span>:<span style=color:#e6db74>&#34;utest&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#f92672>&#34;database.connection.adapter&#34;</span>:<span style=color:#e6db74>&#34;logminer&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#f92672>&#34;table.include.list&#34;</span>:<span style=color:#e6db74>&#34;HR.*&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#f92672>&#34;log.mining.strategy&#34;</span>:<span style=color:#e6db74>&#34;online_catalog&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>}
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://imgur.com/GrPflZL.png alt></p><p>其中：</p><ul><li>name：註冊到 Kafka Connect 服務的 Connector 名稱。</li><li>database.server.name：虛擬的資料庫 Server 名稱，可以根據實際需求定義，定義 Kafka topic 時會使用該值。</li><li>table.include.list：監聽的數據表列表，以 <code>,</code> 分割。<code>HR.*</code> 表示監聽 HR 下的所有資料表。</li><li>每個被監控的表在 Kafka 都會對應一個 topic，topic 的命名規範是 <code>&lt;database.server.name>.&lt;schema>.&lt;table></code></li><li>log.mining.strategy：預設為 redo_log_catalog，會造成 kafka consume 延遲，查官網後發現，如果要頻繁修改 DDL (如表的 schema) 才需要設置。使用 <code>online_catalog</code> 只監聽資料表內的 data 變化不會額外寫表的 DDL 資訊，能加速 logminer！</li></ul><h3 id=查看-connector-狀態>查看 Connector 狀態
<a class=header-anchor href=#%e6%9f%a5%e7%9c%8b-connector-%e7%8b%80%e6%85%8b></a></h3><p>下 GET <code>/connectors/&lt;connectorName>/status</code> 的 api</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>curl -H &#34;Accept:application/json&#34; http://127.0.0.1:8083/connectors/oracle1/status
</span></span></code></pre></div><p>如果成功會回傳以下回覆</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;oracle1&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#f92672>&#34;connector&#34;</span>: {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>        <span style=color:#f92672>&#34;state&#34;</span>: <span style=color:#e6db74>&#34;RUNNING&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        <span style=color:#f92672>&#34;worker_id&#34;</span>: <span style=color:#e6db74>&#34;172.17.0.5:8083&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#f92672>&#34;tasks&#34;</span>: [
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>            <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>            <span style=color:#f92672>&#34;state&#34;</span>: <span style=color:#e6db74>&#34;RUNNING&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>            <span style=color:#f92672>&#34;worker_id&#34;</span>: <span style=color:#e6db74>&#34;172.17.0.5:8083&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    ],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;source&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>}
</span></span></code></pre></div><h3 id=增刪改資料表並查看-kafka-topic-是否有收到-log-資料>增刪改資料表並查看 Kafka Topic 是否有收到 log 資料
<a class=header-anchor href=#%e5%a2%9e%e5%88%aa%e6%94%b9%e8%b3%87%e6%96%99%e8%a1%a8%e4%b8%a6%e6%9f%a5%e7%9c%8b-kafka-topic-%e6%98%af%e5%90%a6%e6%9c%89%e6%94%b6%e5%88%b0-log-%e8%b3%87%e6%96%99></a></h3><p>使用 kafka clinet 腳本程式列出目前 kafka server 上的所有 topic</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>$ ./kafka-topics.sh --list --bootstrap-server 10.13.1.105:9092
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>XE
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>XE.HR.COUNTRIES
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>XE.HR.DEPARTMENTS
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>XE.HR.EMPLOYEES
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>XE.HR.JOBS
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>XE.HR.JOB_HISTORY
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>XE.HR.LOCATIONS
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>XE.HR.REGIONS
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>__consumer_offsets
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>test_connect_configs
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>test_connect_offsets
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>test_connect_statuses
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>utest
</span></span></code></pre></div><p>開啟 kafka consumer 消費 logminer 捕捉 HR.EMPLOYEES 表的變化</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ ./kafka-console-consumer.sh --bootstrap-server 10.13.1.105:9092 --topic XE.HR.EMPLOYEES --from-beginning
</span></span></code></pre></div><p>進入資料庫操作目標資料表 HR.EMPLOYEES，新增一筆員工資料</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sqlplus sys<span style=color:#f92672>/</span>oracle<span style=color:#f92672>@</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span>:<span style=color:#ae81ff>1521</span><span style=color:#f92672>/</span>xe <span style=color:#66d9ef>as</span> sysdba
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> HR.EMPLOYEES(EMPLOYEE_ID,FIRST_NAME,LAST_NAME,EMAIL,PHONE_NUMBER,HIRE_DATE,JOB_ID,SALARY,MANAGER_ID,DEPARTMENT_ID) <span style=color:#66d9ef>values</span>(<span style=color:#ae81ff>206</span>,<span style=color:#e6db74>&#39;Kawhi&#39;</span>,<span style=color:#e6db74>&#39;Leonard&#39;</span>,<span style=color:#e6db74>&#39;KAWHI&#39;</span>,<span style=color:#e6db74>&#39;111.222.3333&#39;</span>,<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>01</span><span style=color:#f92672>-</span><span style=color:#ae81ff>19</span> <span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>,<span style=color:#e6db74>&#39;SH_CLERK&#39;</span>,<span style=color:#ae81ff>15000</span>,<span style=color:#ae81ff>124</span>,<span style=color:#ae81ff>50</span>);
</span></span></code></pre></div><p>回到 kafka consumer 的 terminal 可以發現可以收到 logminer 變動的資料</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://imgur.com/00Ul63W.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://imgur.com/KArHEsu.png alt></p><h2 id=reference>Reference
<a class=header-anchor href=#reference></a></h2><ul><li><a href="https://www.796t.com/article.php?id=169153" title="https://www.796t.com/article.php?id=169153" rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://www.796t.com/article.php?id=169153
<i class="fa fa-external-link-alt"></i></a></li><li><a href=https://www.itread01.com/content/1549275121.html title=https://www.itread01.com/content/1549275121.html rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://www.itread01.com/content/1549275121.html
<i class="fa fa-external-link-alt"></i></a></li><li><a href=https://debezium.io/documentation/reference/stable/connectors/oracle.html title=https://debezium.io/documentation/reference/stable/connectors/oracle.html rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://debezium.io/documentation/reference/stable/connectors/oracle.html
<i class="fa fa-external-link-alt"></i></a></li><li><a href=https://python.iitter.com/other/229206.html title=https://python.iitter.com/other/229206.html rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://python.iitter.com/other/229206.html
<i class="fa fa-external-link-alt"></i></a></li></ul></div><footer class=post-footer><div class=post-tags><a href=/tags/debezium>Debezium</a>
<a href=/tags/cdc>CDC</a>
<a href=/tags/oracle>Oracle</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/devops-selenium-chrome-docker-img/build-selenium-chrome-docker-image/ rel=next title="[Docker] 包 Selenium Chrome Docker Image"><i class="fa fa-chevron-left"></i> [Docker] 包 Selenium Chrome Docker Image</a></div><div class="post-nav-prev post-nav-item"><a href=/post/programming-golang-tebeka-selenium/golang-tebeka-selenium/ rel=prev title="[golang] 使用 tebeka selenium 爬蟲模擬操控網頁">[golang] 使用 tebeka selenium 爬蟲模擬操控網頁
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2019 - 2023</span>
<span class=with-love><i class="fa fa-paw"></i></span>
<span class=author itemprop=copyrightHolder>Ula Hsieh</span></div><div class=powered-by>Power by <a href=https://gohugo.io title=0.112.3 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.2 target=_blank>Hugo NexT.Gemini</a></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"algolia":{"cfg":{"apikey":"bfe7770719b1074e97acc36accb13bf0","appid":"D00OUNE9TK","enable":true,"hits":{"perpage":10},"indexname":"next-ulagraphy","limit":1e3},"instantjs":{"file":"dist/instantsearch.production.min.js","name":"instantsearch.js","version":"4.49.0"},"js":{"file":"dist/algoliasearch-lite.umd.js","name":"algoliasearch","version":"4.14.2"}},"bookmark":{"color":"#222","enable":false,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://ulagraphy.netlify.com","i18n":{"ds_day":" Day Ago","ds_days":" Day ","ds_hour":" Hour Ago","ds_hours":" Hour ","ds_just":"Just","ds_min":" Min Ago","ds_mins":" Min","ds_month":" Month Ago","ds_years":" Year ","empty":"We didn't find any results for the search: ${query}","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms","placeholder":"Searching..."},"lang":"en","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":false,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":240},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.2","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.0324574053d02d3fbf9394acb1826aa1bab033e431839d37bcc63ee8cb9b302d.js defer></script></body></html>